
automacro validate {
	NpcMsg /验证\d+/ #npc说的话符合这个条件时触发, \d是正则表达式，表示任意数字
	overrideAI 1 #机器人停止其他动作
    exclusive 1	 #无法被其他巨集打断
    call {
		$catch = $.NpcMsgLastMsg #$.NpcMsgLastMsg表示前面捕获的npc说的话，赋值给$catch
		call pass
	}
}

macro pass {
	$str = "$catch"
	$num = get_num($str) #调用get_num函数, 此函数用的是perl脚本语法, 获取npc说的话中的数字部分
	$result = &eval($num-1) #因为是数组, 所以下标需要减1
	@array = (157266,710609,638238,509052,931953,393528,275011,140666,823342,950038,251339,648437,718757,994525,918089,539011,874461,995430,451712,479678,898308,982901,510302,327093,746108,109099,207371,474411,698811,924925,768697,976504,421008,652400,937825,288770,729417,838293,354476,632881,870877,869134,279803,169764,879185,883507,344611,401688,503943,745223,807502,906898,737982,788429,524235,283643,617526,116603,235097,240357,977165,302025,101730,356479,820265,290012,731071,665034,321640,679946,845784,322333,934343,386995,714493,890886,464422,812839,997467,232540,753003,973837,400991,780267,776441,469352,151681,724130,410524,639960,524691,429647,463308,710847,193926,609919,775048,557291,338227,808759,528252,870553,461402,783584,118051,927915,936075,871333,624801,273678,430926,625404,241257,726594,895880,516372,337609,212668,388174,494964,342943,173606,985865,849951,745899,670818,219692,129658,957780,639755,117504,883892,288646,504550,552767,825066,452912,831093,406958,936578,406380,145846,271115,160831,814306,364616,475890,858455,748332,575655,673057,983474,916344,804012,875184,356886,390717,351372,700750,862142,227421,894881,703355,783008,465895,404053,102308,343123,504666,158660,294509,435247,247794,448461,740495,713345,958005,284195,605568,407024,629535,301275,248486,718228,146881,473345,554927,493555,968201,666426,374285,887511,293501,307064,543235,153439,458557,709660,974720,531067,302782,702216,161489,770160,204293,662558,550721,152344,674012,697534,572406,576488,430440,624763,955424,937234,766776,253924,807587,190327,600680,809547,206193,176371,133515,316158,909686,524288,534566,472378,962118,128428,590025,812420,243590,894978,494688,932406,906463,167855,279749,259232,656575,921065,988835,108456,304110,251886,113204,978021,696002,897433,417165,502299,140459,905915,985405,256320,784121,461650,291464,850249,186616,595045,504385,414235,490113,468502,243725,277987,174197,188111,246823,753855,520095,320478,746111,359123,930432,203821,121407,180106,941675,810444,362096,600673,144225,880608,208358,641772,857333,113227,928502,963180,893556,202862,897872,151463,853698,576349,343295,845695,640261,514343,970229,471542,147306,165661,474689,837735,210539,930302,874089,367453,923339,453360,436591,400156,728152,311484,152899,666098,355093,843359,173941,634586,876763,814914,205916,412391,324638,274722,439738,317664,581314,107648,109848,996903,603256,896180,613708,719124,189399,180923,701633,963567,374515,202276,634849,648436,540819,299217,295039,656883,621711,638629,203505,860261,963760,246825,115207,339739,907349,819693,204418,945739,838175,678123,419421,128489,582839,967600,958173,907627,256923,403973,679559,467683,448690,630907,541881,558397,560193,334631,835582,581579,336508,954904,825636,216993,105606,708482,548372,172648,442579,136801,582490,471608,307124,465028,270221,126573,901115,877793,712699,544976,516051,606719,429223,970593,164087,616188,845701,426821,231238,148812,311603,209844,314605,886311,194449,483230,997070,564216,495217,190465,735392,918206,227766,877637,907822,397785,255103,532484,801770,710069,976352,963523,685713,594580,946517,695245,243378,496365,468790,906525,308778,838452,459933,106976,392439,998000,854798,780786,513320,795130,606589,733363,708289,588122,928897,968531,266470,506533,939625,453642,668195,472377,421591,614602,804543,104964,964799,691863,600381,876141,510898,984888,970818,953016,252076,979010,840756,436348,919003,609912,437790,806992,351929,344310,878250,110001,396824,215553,571053,352975,712226,225513,456831,285876)
	log $array[$result]	#通过下标获取数组中存的数字
	do talk num $array[$result]
}

sub get_num {
	(my $var)=@_;
	$len = length($var); #获取字符串长度
	$substring = substr($var, 10, $len);  #截取字符串中的数字
	return $substring
}


automacro DC {
	InMap livion
	priority 0
	run-once 1
	call {
		pause 1
		do respawn
		pause 1
		do talk &npc(177 219)
		pause 1
		do talk resp 0
		release all
	}
}

automacro DC2 {
	InMap 1@DC_1
	MobNearCount < 1
 	NpcNear /[始祖道场]/
	priority 1
	exclusive 1
	run-once 1
	call {
		pause 3
		do talk &npc("$.NpcNearLast")
		pause 1
		do talk resp 0
		pause 1
		release all
	}
}

automacro DC3 {
	InMap 1@DC_1
	NpcNearCount > 1
	priority 0
	exclusive 1
	timeout 20
	call {
		pause 5
		do talk &npc(49 50)
		pause 1
	}
}
